<html>

<head>
    <title>数据脉络</title>
    <meta charset="utf-8">
    <script src="http://data-visual.cn/datav/src/js/echarts/echarts-3.2.3.min.js"></script>
    <script src="http://data-visual.cn/datav/src/js/jquery/jquery-3.1.1.min.js"></script>
    <style type="text/css">
    body {
        margin: 0;
        padding: 5;
    }
    
    #main {
        height: 90%;
    }
    </style>
</head>

<body>
    <div id="main"></div>
    <script>
    $('#main').css({
        height: $('body').height(),
        width: $('body').width()
    });

    $.get('../data/asset/geo/HK.json', function(chinaJson) {
        echarts.registerMap('china', chinaJson);
        var chart = echarts.init(document.getElementById('main'));
        /*chart.setOption({
            series: [{
                type: 'map',
                map: 'china'
            }]
        });*/
        var geoCoordMap = {
            '市住建委': [-400, 310],
            '工商前置机': [320, 510],
            '中心库': [-116, 400],
            '网格平台': [300, 130],
            '人社局前置机': [-336, 600],
            '公安前置机': [200, 390],
            '市食药局': [251, 310],
            '市卫计委': [300, 230],
            '证照文库': [-200, 300],
            '规整库': [-105, 500],
            '一站通平台': [-125, 640]
        };

        var BJData = [
            [{
                name: '中心库'
            }, {
                name: '市住建委',
                value: 95
            }],
            [{
                name: '中心库'
            }, {
                name: '市卫计委',
                value: 90
            }],
            [{
                name: '中心库'
            }, {
                name: '公安前置机',
                value: 80
            }],
            [{
                name: '中心库'
            }, {
                name: '网格平台',
                value: 70
            }],
            [{
                name: '中心库'
            }, {
                name: '人社局前置机',
                value: 60
            }],
            [{
                name: '中心库'
            }, {
                name: '证照文库',
                value: 50
            }],
            [{
                name: '中心库'
            }, {
                name: '一站通平台',
                value: 40
            }],
            [{
                name: '中心库'
            }, {
                name: '工商前置机',
                value: 30
            }],
            [{
                name: '中心库'
            }, {
                name: '规整库',
                value: 20
            }],
            [{
                name: '中心库'
            }, {
                name: '市食药局',
                value: 10
            }]
        ];

        var SHData = [
            [{
                name: '市住建委'
            }, {
                name: '工商前置机',
                value: 95
            }],
            [{
                name: '市住建委'
            }, {
                name: '市卫计委',
                value: 80
            }],
            [{
                name: '市住建委'
            }, {
                name: '一站通平台',
                value: 60
            }],
            [{
                name: '市住建委'
            }, {
                name: '规整库',
                value: 50
            }],
            [{
                name: '市住建委'
            }, {
                name: '中心库',
                value: 30
            }],
            [{
                name: '市住建委'
            }, {
                name: '公安前置机',
                value: 10
            }]
        ];



        var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';


        planePath = 'path://M64.892451 785.563516 64.892451 673.734568l391.401318-391.402341c0 0 29.15911-29.161157 55.914474-55.914474 29.046546 29.04757 55.914474 55.914474 55.914474 55.914474l391.402341 391.402341 0 111.828948L847.69611 785.563516 512.208243 450.075649 176.721399 785.563516 64.892451 785.563516z';

        planePath = 'path://M925.567 783.166c22.528 22.464 59.072 22.464 81.536 0 22.528-22.464 22.528-58.944 0-81.408l-432.255-431.295c-22.528-22.4-59.072-22.4-81.536 0-22.528 22.464-22.528 58.944 0 81.408l432.255 431.295z + M57.345 705.727c-21.248 21.248-21.248 55.68 0 76.864s55.744 21.184 76.993 0l437.183-436.223c21.248-21.184 21.248-55.616 0-76.8-21.248-21.248-55.744-21.249-76.993 0l-437.183 436.159z';

        planePath = 'path://M524.8 972.8c-7.68 0-12.8-5.12-12.8-12.8L512 64c0-7.68 5.12-12.8 12.8-12.8 7.68 0 12.8 5.12 12.8 12.8l0 896C537.6 967.68 532.48 972.8 524.8 972.8z + M113.92 486.4c-3.84 0-6.4-1.28-8.96-3.84-5.12-5.12-5.12-12.8 0-17.92l410.88-409.6c5.12-5.12 12.8-5.12 17.92 0 5.12 5.12 5.12 12.8 0 17.92l-410.88 409.6C120.32 485.12 116.48 486.4 113.92 486.4z + M910.08 480c-3.84 0-6.4-1.28-8.96-3.84L515.84 72.96c-5.12-5.12-5.12-12.8 0-17.92 5.12-5.12 12.8-5.12 17.92 0l385.28 403.2c5.12 5.12 5.12 12.8 0 17.92C916.48 478.72 913.92 480 910.08 480z';


        var convertData = function(data) {
            var res = [];
            for (var i = 0; i < data.length; i++) {
                var dataItem = data[i];
                var fromCoord = geoCoordMap[dataItem[0].name];
                var toCoord = geoCoordMap[dataItem[1].name];
                if (fromCoord && toCoord) {
                    res.push({
                        fromName: dataItem[0].name,
                        toName: dataItem[1].name,
                        coords: [fromCoord, toCoord]
                    });
                }
            }
            return res;
        };

        var color = ['#a6c84c', '#ffa022', '#46bee9', '#f6bee9'];
        var series = [];
        [
            ['北京', BJData],
            ['上海', SHData]
        ].forEach(function(item, i) {
            series.push({
                name: item[0] + ' Top10',
                type: 'lines',
                zlevel: 1,
                effect: {
                    show: true,
                    period: 6,
                    trailLength: 0.7,
                    color: '#fff',
                    symbolSize: 3
                },
                lineStyle: {
                    normal: {
                        color: color[i],
                        width: 0,
                        curveness: 0.2
                    }
                },
                data: convertData(item[1])
            }, {
                name: item[0] + ' Top10',
                type: 'lines',
                zlevel: 2,
                effect: {
                    show: true,
                    period: 6,
                    trailLength: 0,
                    symbol: planePath,
                    symbolSize: 15
                },
                lineStyle: {
                    normal: {
                        color: color[i],
                        width: 1,
                        opacity: 0.4,
                        curveness: 0.2
                    }
                },
                data: convertData(item[1])
            }, {
                name: item[0] + ' Top10',
                type: 'effectScatter',
                coordinateSystem: 'geo',
                zlevel: 2,
                rippleEffect: {
                    brushType: 'stroke'
                },
                label: {
                    normal: {
                        show: true,
                        position: 'right',
                        formatter: '{b}'
                    }
                },
                symbolSize: function(val) {
                    return val[2] / 8;
                },
                itemStyle: {
                    normal: {
                        color: color[i]
                    }
                },
                data: item[1].map(function(dataItem) {
                    return {
                        name: dataItem[1].name,
                        value: geoCoordMap[dataItem[1].name].concat([dataItem[1].value])
                    };
                })
            });
        });

        option = {
            backgroundColor: '#323C48',
            title: {
                text: '数据脉络图',
                //subtext: '数据流向',
                left: 'center',
                textStyle: {
                    color: '#fff'
                }
            },
            tooltip: {
                trigger: 'item'
            },
            legend: {
                orient: 'vertical',
                top: 'bottom',
                left: 'right',
                data: ['数据服务图', '上海 Top10'],
                textStyle: {
                    color: '#fff'
                },
                selectedMode: 'single'
            },
            geo: {
                map: 'china',
                label: {
                    emphasis: {
                        show: false
                    }
                },
                roam: true,
                zoom: 2,
                itemStyle: {
                    normal: {
                        areaColor: '#323c48',
                        borderColor: '#404a59'
                    },
                    emphasis: {
                        areaColor: '#2a333d'
                    }
                }
            },
            series: series
        };



        var myOption = {
            "backgroundColor": "#323C48",
            "title": {
                "text": "数据脉络图",
                "left": "center",
                "textStyle": {
                    "color": "#fff"
                }
            },
            "tooltip": {
                "trigger": "item"
            },
            "legend": {
                "orient": "vertical",
                "top": "bottom",
                "left": "right",
                "data": ["数据服务图"],
                "textStyle": {
                    "color": "#fff"
                },
                "selectedMode": "single"
            },
            geo: {
                "map": "china",
                "label": {
                    "emphasis": {
                        "show": false
                    }
                },
                roam: true,
                zoom: 1.5,
                "itemStyle": {
                    "normal": {
                        "areaColor": "#323c48",
                        "borderColor": "#404a59"
                    },
                    "emphasis": {
                        "areaColor": "#2a333d"
                    }
                }
            },
            series: [{
                name: "数据服务图",
                type: "lines",
                coordinateSystem: 'geo',
                zlevel: 2,
                label: {
                    normal: {
                        show: true,
                        position: 'middle',
                        formatter: function() {
                            return "5类"
                        },
                        textStyle: {
                            color: '#fff',
                            fontSize: 10
                        }
                    }
                },
                effect: {
                    "show": true,
                    "period": 6,
                    "trailLength": 0,
                    symbol: planePath,
                    "symbolSize": 15
                },
                "lineStyle": {
                    "normal": {
                        "color": "#a6c84c",
                        "width": 2,
                        "opacity": 0.4,
                        "curveness": 0.2
                    }
                },
                "data": [{
                    "fromName": "中心库",
                    "toName": "市住建委",
                    "coords": [
                        [-116, 400],
                        [-400, 310]
                    ],
                    // 统一的样式设置
                    lineStyle: {
                        normal: {
                            color: "#FEF",
                            width: 5,
                            type: 'dotted',
                            curveness:0
                        }
                    }



                }, {
                    "fromName": "中心库",
                    "toName": "市卫计委",
                    "coords": [
                        [-116, 400],
                        [300, 230]
                    ],
                    lineStyle: {
                        normal: {
                            color: "#FEF",
                            width: 1,
                            type: 'dotted'
                        }
                    }
                }, {
                    "fromName": "中心库",
                    "toName": "公安前置机",
                    "coords": [
                        [-116, 400],
                        [200, 390]
                    ],
                    lineStyle: {
                        normal: {
                            color: "#FF4040",
                            opacity: 0.8,
                            width: 3,
                            type: 'dashed'
                        }
                    }
                }, {
                    "fromName": "中心库",
                    "toName": "网格平台",
                    "coords": [
                        [-116, 400],
                        [300, 130]
                    ],
                    lineStyle: {
                        normal: {
                            color: "#FFA500",
                            width: 5,
                            type: 'solid',
                            curveness:0
                        }
                    }


                }, {
                    "fromName": "中心库",
                    "toName": "人社局前置机",
                    "coords": [
                        [-116, 400],
                        [-336, 600]
                    ]
                }, {
                    "fromName": "中心库",
                    "toName": "证照文库",
                    "coords": [
                        [-116, 400],
                        [-200, 150]
                    ]
                }, {
                    "fromName": "中心库",
                    "toName": "一站通平台",
                    "coords": [
                        [-116, 400],
                        [-125, 640]
                    ]
                }, {
                    "fromName": "中心库",
                    "toName": "工商前置机",
                    "coords": [
                        [-116, 400],
                        [320, 510]
                    ]

                }, {
                    "fromName": "中心库",
                    "toName": "规整库",
                    "coords": [
                        [-116, 400],
                        [-105, 500]
                    ],
                    lineStyle: {
                        normal: {
                            color: "#FFA500",
                            width: 3,
                            type: 'solid',
                            curveness:0
                        }
                    }
                }, {
                    "fromName": "中心库",
                    "toName": "市食药局",
                    "coords": [
                        [-116, 400],
                        [251, 310]
                    ]
                }]
            }, {
                "name": "数据服务图",
                "type": "effectScatter",
                "coordinateSystem": "geo",
                "zlevel": 2,
                "rippleEffect": {
                    "brushType": "stroke"
                },
                "label": {
                    "normal": {
                        "show": true,
                        "position": "right",
                        "formatter": "{b}"
                    }
                },
                "itemStyle": {
                    "normal": {
                        "color": "#a6c84c"
                    }
                },
                "data": [{
                    "name": "中心库",
                    symbol: 'circle',
                    symbolSize: 42,
                    "value": [-116, 400, 95],
                    "itemStyle": {
                        "normal": {
                            "color": "#FFA500"
                        }
                    }



                }, {
                    "name": "市住建委",
                    symbol: 'roundRect',
                    symbolSize: 16,
                    "value": [-400, 310, 95],
                    "itemStyle": {
                        "normal": {
                            "color": "#4876FF"
                        }
                    }
                }, {
                    "name": "市卫计委",
                    symbol: 'roundRect',
                    symbolSize: 18,
                    "value": [300, 230, 90],
                    "itemStyle": {
                        "normal": {
                            "color": "#228B22"
                        }
                    }
                }, {
                    "name": "公安前置机",
                    symbol: 'roundRect',
                    symbolSize: 28,
                    "value": [200, 390, 80],
                    "itemStyle": {
                        "normal": {
                            "color": "#4A708B"
                        }
                    }
                }, {
                    "name": "网格平台",
                    symbol: 'roundRect',
                    symbolSize: 38,
                    "value": [300, 130, 70]
                }, {
                    "name": "人社局前置机",
                    symbol: 'diamond',
                    symbolSize: 18,
                    "value": [-336, 600, 60],
                     "itemStyle": {
                        "normal": {
                            "color": "#228B22"
                        }
                    }


                }, {
                    "name": "证照文库",
                    "value": [-200, 150, 50],
                     "itemStyle": {
                        "normal": {
                            "color": "#128B22"
                        }
                    }
                }, {
                    "name": "一站通平台",
                    symbol: 'roundRect',
                    symbolSize: 28,
                    "value": [-125, 640, 40]
                }, {
                    "name": "工商前置机",
                    "value": [320, 510, 30],
                     "itemStyle": {
                        "normal": {
                            "color": "#FF34B3"
                        }
                    }
                }, {
                    "name": "规整库",
                    "value": [-105, 500, 20],
                    "itemStyle": {
                        "normal": {
                            "color": "#FF1213"
                        }
                    }
                }, {
                    "name": "市食药局",
                    symbol: 'diamond',
                    symbolSize: 18,
                    "value": [251, 310, 10]
                }]
            }]
        };

        chart.setOption(myOption);

        chart.on('click', function(params) {
            alert(params.componentSubType);
            alert(params.data.dataType);

        });




    });
    </script>
</body>

</html>
